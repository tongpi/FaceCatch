{% extends "base.html" %}

{% block content%}

    <content class="app-content">
      <div class="container">
        <div class="card pl-3 pr-3 mt-3 pb-5">
            <div class="card-body">
                <div class="clearfix pt-3 pb-3">
                  <span class="float-left">
                      <h5><i class="anticon icon-home"></i> 在线识别</h5>
                  </span>
                </div>

                <hr>

                <div class="match-result">
                <span id="image"></span>
                        <div class="title_box mt-4 mb-4">
                            <h5>摄像头</h5>
                            <span class="title_icon"></span>
                        </div>

                        <div class="row">
                            <div class="col-sm-6">
                                <img id="imageid" src="{{url_for('facecatch.realtime_video.views.video_feed')}}" style="width: 500px;height: 450px; background: #dddddd;">
                            </div>
                            <div class="col-sm-6">
                                <div id="result_id"></div>
                            </div>
                        </div>

                </div>

            </div>
        </div>
      </div>
    </content>

     <script>
      $(function() {
          setTimeout(function(){
                setTimer();
            },2000);
          function setTimer(){
              // 设置间隔7秒进行一次识别
              setInterval(recognize, 1200000)
          }
        });

        // 进行识别请求
        function recognize(){
              $.ajax({
                  type: 'post',
                  contentType: "application/json; charset=UTF-8",
                  headers: {'X-CSRFToken': '{{csrf_token()}}'},
                  url: '/recognize',
                  success: function (data) {
                      var result_html = '';
                        if (data['message'] != '' && data['message'] != null){
                            personInfo = data['message'];
                            result_html += '<h5>识别结果：</h5>' +
                                '<ul><li><span class="font-weight-bold">名称：</span>'+ personInfo['name'] +'</li> ' +
                                '<li><span class="font-weight-bold">证件号：</span>'+ personInfo['id_card'] +'</li> ' +
                                '<li><span class="font-weight-bold">描述：</span>'+ personInfo['description'] +'</li>' +
                                '<li><span class="font-weight-bold">表情：</span>'+ data['emotion'] +'</li></ul>'
                        }

                        if(data['not_message']!='' && data['not_message'] != null){
                            result_html += "<h5>识别结果：</h5><ul><li><span class=\"font-weight-bold\">"+ data['not_message'] +"</span></li></ul>"
                        }

                      $("#result_id").empty();
                      $("#result_id").append(result_html)
                  }
              });
            }
      </script>
{% endblock %}
